workflows:
  ios-release-workflow:
    name: iOS Release Workflow
    max_build_duration: 60
    environment:
      flutter: stable
      xcode: latest
      cocoapods: default
      vars:
        FLUTTER_CHANNEL: stable
    triggering:
      events:
        - push
        - pull_request
    scripts:
      # 1ï¸âƒ£ æ›´æ–° CocoaPods
      - name: Update CocoaPods
        script: |
          echo "ğŸ’ æ›´æ–° RubyGems å’Œ CocoaPods"
          sudo gem update --system
          sudo gem install cocoapods
          pod --version
      # 2ï¸âƒ£ è·å– Flutter ä¾èµ–
      - name: Flutter Pub Get
        script: |
          echo "ğŸ“¦ è·å– Flutter ä¾èµ–"
          flutter pub get
      # 3ï¸âƒ£ å®‰è£… iOS Pods
      - name: Install iOS Pods
        script: |
          echo "ğŸ“± å®‰è£… iOS Pods"
          cd ios
          pod install --repo-update
          cd ..
      # 4ï¸âƒ£ æ„å»º iOS Releaseï¼ˆç”Ÿæˆ IPA å¹¶ä½¿ç”¨ Codemagic ç­¾åï¼‰
      - name: Build iOS Release
        script: |
          echo "ğŸ—ï¸ æ„å»º iOS Release"
          flutter build ios --release --no-codesign
      # 5ï¸âƒ£ å¯é€‰ï¼šæ„å»º Debug ç‰ˆæœ¬ï¼ˆç”¨äºæµ‹è¯•ï¼‰
      - name: Build iOS Debug
        script: |
          echo "ğŸ—ï¸ æ„å»º iOS Debug"
          flutter build ios --debug --no-codesign

    artifacts:
      # ç”Ÿæˆçš„ Runner.app
      - build/ios/iphoneos/Runner.app
      # Release æ„å»ºç”Ÿæˆçš„ IPA æ–‡ä»¶ï¼ˆCodemagic ä¼šæ ¹æ®ç­¾åç”Ÿæˆï¼‰
      - build/ios/ipa/*.ipa

    cache:
      - flutter
      - cocoapods
      - $FLUTTER_ROOT/.pub-cache
